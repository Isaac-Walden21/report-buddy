<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#d4a53c">
  <meta name="description" content="AI-powered police report writing assistant">
  <title>Report Buddy</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" type="image/png" href="/icons/icon-192.png">
</head>
<body>
  <div class="app">
    <!-- Auth Views -->
    <div id="auth-view" class="auth-container">
      <div id="login-form" class="auth-form">
        <img src="/images/logo.png" alt="Report Buddy" class="auth-logo">
        <h2>Report Buddy</h2>
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" class="form-input" placeholder="your@email.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" class="form-input" placeholder="Password" autocomplete="current-password">
        </div>
        <button id="login-btn" class="btn btn-primary" style="width:100%">Log In</button>
        <p class="auth-link">Don't have an account? <a href="#" id="show-register">Sign up</a></p>
      </div>

      <div id="register-form" class="auth-form hidden">
        <img src="/images/logo.png" alt="Report Buddy" class="auth-logo">
        <h2>Create Account</h2>
        <div class="form-group">
          <label for="register-name">Full Name</label>
          <input type="text" id="register-name" class="form-input" placeholder="Your name" autocomplete="name">
        </div>
        <div class="form-group">
          <label for="register-email">Email</label>
          <input type="email" id="register-email" class="form-input" placeholder="your@email.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label for="register-password">Password</label>
          <input type="password" id="register-password" class="form-input" placeholder="Min 8 characters" autocomplete="new-password">
        </div>
        <button id="register-btn" class="btn btn-primary" style="width:100%">Create Account</button>
        <p class="auth-link">Already have an account? <a href="#" id="show-login">Log in</a></p>
      </div>
    </div>

    <!-- Main App (hidden until logged in) -->
    <div id="app-view" class="hidden">
      <header class="header">
        <div class="header-brand">
          <img src="/images/logo.png" alt="Report Buddy" class="header-logo">
          <h1>Report Buddy</h1>
        </div>
        <div>
          <span id="user-name"></span>
          <button id="manage-plan-btn" class="btn btn-secondary hidden">Manage Plan</button>
          <button id="settings-btn" class="btn btn-secondary">Settings</button>
          <button id="logout-btn" class="btn btn-secondary">Logout</button>
        </div>
      </header>

      <!-- Subscription Banner -->
      <div id="subscription-banner" class="subscription-banner hidden">
        <span id="subscription-banner-text"></span>
        <button id="banner-subscribe-btn" class="btn btn-primary btn-sm hidden">Subscribe Now</button>
      </div>

      <main class="main">
        <!-- Dashboard -->
        <div id="dashboard-view">
          <h2>New Report</h2>
          <div class="dashboard-grid">
            <div class="report-type-btn" data-type="incident">
              <h3>Incident Report</h3>
              <p>Calls for service, disturbances, general incidents</p>
            </div>
            <div class="report-type-btn" data-type="arrest">
              <h3>Arrest Report</h3>
              <p>Arrests, bookings, charges</p>
            </div>
            <div class="report-type-btn" data-type="supplemental">
              <h3>Supplemental</h3>
              <p>Follow-ups and additional information</p>
            </div>
          </div>

          <h2>Recent Reports</h2>
          <div id="reports-list" class="reports-list">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Report Input View -->
        <div id="input-view" class="hidden">
          <div class="card">
            <h2 id="input-report-type" class="mb-2">New Report</h2>
            <div class="text-center mb-2">
              <div class="voice-controls">
                <button id="voice-btn" class="voice-btn">
                  <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                    <line x1="12" y1="19" x2="12" y2="23"/>
                    <line x1="8" y1="23" x2="16" y2="23"/>
                  </svg>
                </button>
                <button id="clear-transcript-btn" class="btn btn-secondary clear-btn">Clear</button>
              </div>
              <p class="mt-1" id="voice-status">Tap to start speaking</p>
            </div>
            <div class="form-group">
              <label>Or type your description</label>
              <textarea id="transcript-input" class="form-input" rows="8" placeholder="Describe what happened..."></textarea>
            </div>
            <div id="followup-questions" class="hidden mb-2">
              <!-- AI follow-up questions appear here -->
            </div>
            <div style="display:flex;gap:1rem">
              <button id="back-btn" class="btn btn-secondary">Back</button>
              <button id="generate-btn" class="btn btn-primary" style="flex:1">Generate Report</button>
            </div>
          </div>
        </div>

        <!-- Report Editor View -->
        <div id="editor-view" class="hidden">
          <div class="editor-layout">
            <!-- Left: Transcript -->
            <div class="editor-panel">
              <div class="panel-header">Your Notes</div>
              <div class="panel-content">
                <div id="editor-transcript"></div>
              </div>
            </div>

            <!-- Center: Report -->
            <div class="editor-panel">
              <div class="panel-header">
                <div class="title-edit-container">
                  <input type="text" id="report-title" class="title-input" placeholder="Report title...">
                </div>
                <button id="copy-btn" class="btn btn-secondary">Copy</button>
              </div>
              <div class="format-toolbar">
                <button type="button" class="format-btn" data-command="bold" title="Bold (Ctrl+B)"><b>B</b></button>
                <button type="button" class="format-btn" data-command="italic" title="Italic (Ctrl+I)"><i>I</i></button>
                <button type="button" class="format-btn" data-command="underline" title="Underline (Ctrl+U)"><u>U</u></button>
                <button type="button" class="format-btn highlight-btn" data-command="highlight" title="Highlight">H</button>
              </div>
              <div class="panel-content">
                <div id="editor-content" class="rich-editor" contenteditable="true"></div>
              </div>
              <div style="padding:1rem;border-top:1px solid var(--border);display:flex;gap:0.5rem">
                <input type="text" id="refine-input" class="form-input" placeholder="Ask AI to make changes..." style="flex:1">
                <button id="refine-btn" class="btn btn-primary">Refine</button>
              </div>
            </div>

            <!-- Right: Legal Assistant -->
            <div class="editor-panel">
              <div class="panel-header">
                Legal Assistant
                <div class="panel-header-buttons">
                  <button id="caselaw-btn" class="btn btn-secondary">Case Law</button>
                  <button id="analyze-btn" class="btn btn-secondary">Elements</button>
                  <button id="editor-court-prep-btn" class="btn btn-secondary">Court Prep</button>
                </div>
              </div>
              <div class="panel-content" id="legal-content">
                <p class="text-muted"><strong>Case Law</strong> - Get case citations and policy recommendations<br><strong>Elements</strong> - Verify your report meets statutory elements</p>
              </div>
              <div id="charges-section" class="charges-section hidden">
                <div class="charges-header">Suggested Charges</div>
                <div id="charges-list" class="charges-list">
                  <!-- Populated by JS -->
                </div>
                <button id="check-elements-btn" class="btn btn-primary" style="width:100%;margin-top:0.5rem">Check Elements</button>
              </div>
            </div>
          </div>
          <div style="margin-top:1rem;display:flex;gap:1rem">
            <button id="editor-back-btn" class="btn btn-secondary">Back to Dashboard</button>
            <button id="save-draft-btn" class="btn btn-secondary">Save Draft</button>
            <button id="mark-complete-btn" class="btn btn-primary">Mark Complete</button>
          </div>
        </div>

        <!-- Court Prep View -->
        <div id="court-prep-view" class="hidden">
          <div class="court-prep-layout">
            <!-- Left Column: Report Summary -->
            <div class="court-prep-panel court-prep-report">
              <div class="panel-header">
                Report Summary
                <button id="court-prep-back-btn" class="btn btn-secondary">Back</button>
              </div>
              <div class="panel-content">
                <h4 id="court-prep-report-title" class="court-prep-title"></h4>
                <div id="court-prep-report-content" class="court-prep-report-text"></div>
              </div>
            </div>

            <!-- Right Column: Cross-Examination -->
            <div class="court-prep-panel court-prep-exam">
              <div class="panel-header">
                Cross-Examination
                <div class="panel-header-buttons">
                  <span id="court-prep-status" class="court-prep-status-badge">Analyzing</span>
                </div>
              </div>

              <!-- Vulnerability Assessment (collapsible) -->
              <div id="court-prep-vuln-section" class="court-prep-vuln-section hidden">
                <button id="court-prep-vuln-toggle" class="court-prep-vuln-toggle">
                  <span>Vulnerability Assessment</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div id="court-prep-vuln-content" class="court-prep-vuln-content"></div>
              </div>

              <!-- Chat Messages -->
              <div id="court-prep-messages" class="court-prep-messages">
                <div id="court-prep-loading" class="court-prep-loading">
                  <div class="court-prep-spinner"></div>
                  <p>Analyzing report for vulnerabilities...</p>
                </div>
              </div>

              <!-- Input Area -->
              <div id="court-prep-input-area" class="court-prep-input-area hidden">
                <div class="court-prep-input-row">
                  <input type="text" id="court-prep-input" class="form-input" placeholder="Type your response...">
                  <button id="court-prep-voice-btn" class="court-prep-voice-btn" title="Voice input">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                      <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                      <line x1="12" y1="19" x2="12" y2="23"/>
                      <line x1="8" y1="23" x2="16" y2="23"/>
                    </svg>
                  </button>
                  <button id="court-prep-send-btn" class="btn btn-primary">Send</button>
                </div>
                <div class="court-prep-actions">
                  <button id="court-prep-end-btn" class="btn btn-secondary">End Session</button>
                  <button id="court-prep-debrief-btn" class="btn btn-primary">Get Debrief</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="hidden">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
            <h2>Settings</h2>
            <button id="settings-back-btn" class="btn btn-secondary">Back to Dashboard</button>
          </div>

          <div class="settings-grid">
            <!-- Department Policies -->
            <div class="card">
              <h3 class="mb-2">Department Policies</h3>
              <p class="text-muted mb-2">Upload your department's policy manual. The AI will reference these when analyzing your reports.</p>

              <div class="form-group">
                <label>Document Name</label>
                <input type="text" id="policy-name" class="form-input" placeholder="e.g., Use of Force Policy">
              </div>
              <div class="form-group">
                <label>Policy Content</label>
                <textarea id="policy-content" class="form-input" rows="4" placeholder="Paste policy text here..."></textarea>
              </div>
              <button id="upload-policy-btn" class="btn btn-primary" style="width:100%">Upload Policy</button>

              <h4 class="mt-2 mb-1">Uploaded Policies</h4>
              <div id="policies-list" class="settings-list">
                <p class="text-muted">No policies uploaded yet.</p>
              </div>
            </div>

            <!-- Case Law -->
            <div class="card">
              <h3 class="mb-2">Case Law References</h3>
              <p class="text-muted mb-2">Add relevant case law. The AI will cite these when validating your actions.</p>

              <div class="form-group">
                <label>Case Name & Citation</label>
                <input type="text" id="caselaw-name" class="form-input" placeholder="e.g., Terry v. Ohio (1968)">
              </div>
              <div class="form-group">
                <label>Key Holdings / Summary</label>
                <textarea id="caselaw-content" class="form-input" rows="4" placeholder="Summarize the relevant holdings..."></textarea>
              </div>
              <button id="upload-caselaw-btn" class="btn btn-primary" style="width:100%">Add Case Law</button>

              <h4 class="mt-2 mb-1">Saved Case Law</h4>
              <div id="caselaw-list" class="settings-list">
                <p class="text-muted">No case law added yet.</p>
              </div>
            </div>

            <!-- Example Reports -->
            <div class="card">
              <h3 class="mb-2">Example Reports (Style Training)</h3>
              <p class="text-muted mb-2">Upload your own reports so the AI learns your writing style. Max 5 per report type.</p>

              <div class="form-group">
                <label>Report Type</label>
                <select id="example-type" class="form-input">
                  <option value="incident">Incident Report</option>
                  <option value="arrest">Arrest Report</option>
                  <option value="supplemental">Supplemental Report</option>
                </select>
              </div>
              <div class="form-group">
                <label>Report Content</label>
                <textarea id="example-content" class="form-input" rows="4" placeholder="Paste a completed report here..."></textarea>
              </div>
              <button id="upload-example-btn" class="btn btn-primary" style="width:100%">Upload Example</button>

              <h4 class="mt-2 mb-1">Uploaded Examples</h4>
              <div id="examples-list" class="settings-list">
                <p class="text-muted">No examples uploaded yet.</p>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Paywall Modal -->
      <div id="paywall-overlay" class="paywall-overlay hidden">
        <div class="paywall-modal">
          <button id="paywall-close-btn" class="paywall-close">&times;</button>
          <div class="paywall-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
          </div>
          <h3>Upgrade to Report Buddy Pro</h3>
          <p class="paywall-subtitle">Your free trial has ended. Subscribe to continue using AI-powered features.</p>
          <ul class="paywall-features">
            <li>AI report generation from voice or text</li>
            <li>Smart report refinement</li>
            <li>Case law analysis &amp; citations</li>
            <li>Charge suggestion &amp; element checking</li>
          </ul>
          <div class="paywall-price">
            <span class="paywall-amount">$9.99</span>
            <span class="paywall-period">/month</span>
          </div>
          <button id="paywall-subscribe-btn" class="btn btn-primary paywall-cta">Subscribe Now</button>
          <p class="paywall-note">Free features (create/edit reports, manage policies) remain available.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>

  <script src="/js/api.js"></script>
  <script src="/js/voice.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
